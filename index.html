<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥½å­•ç®¡å®¶ - ç§‘å­¦å­•æœŸç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #FF85A1;
            --soft-pink: #FFF0F3;
            --text-dark: #4A4A4A;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #FDFBFC;
            color: var(--text-dark);
            -webkit-tap-highlight-color: transparent;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #FF85A1 0%, #FFB1C1 100%);
        }
        .card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 15px rgba(255, 133, 161, 0.1);
        }
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        .chat-bubble-user {
            background-color: var(--primary-pink);
            color: white;
            border-radius: 1rem 1rem 0 1rem;
        }
        .chat-bubble-ai {
            background-color: #F3F4F6;
            color: var(--text-dark);
            border-radius: 1rem 1rem 1rem 0;
        }
        #ai-assistant-panel {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="pb-24">

    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="gradient-bg text-white p-6 rounded-b-[2.5rem] shadow-lg">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-bold">ğŸ‘¶ å¥½å­•ç®¡å®¶ | æˆéƒ½ç‰ˆ</h1>
            <button onclick="openSettings()" class="opacity-80"><i class="fas fa-cog text-xl"></i></button>
        </div>
        
        <div id="countdown-card" class="text-center py-4">
            <p class="text-sm opacity-90 mb-1" id="current-week-display">ç‚¹å‡»è®¾ç½®é¢„äº§æœŸ</p>
            <div class="text-5xl font-black mb-2" id="days-left-display">--</div>
            <p class="text-sm opacity-90">è·å®å®å‡ºç”Ÿè¿˜æœ‰å¤šå°‘å¤©</p>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="mt-6">
            <div class="flex justify-between text-xs mb-1">
                <span>å­•æ—©æœŸ</span>
                <span>å­•ä¸­æœŸ</span>
                <span>å­•æ™šæœŸ</span>
            </div>
            <div class="w-full bg-white/30 h-2 rounded-full overflow-hidden">
                <div id="progress-bar" class="bg-white h-full" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="px-4 mt-6">
        
        <!-- AI åŠ©æ‰‹å¿«æ·æé†’ -->
        <div class="card p-5 mb-6 border-l-4 border-[#FF85A1] flex items-start space-x-3 cursor-pointer" onclick="showTab('ai')">
            <div class="bg-pink-100 p-2 rounded-full">ğŸ¤–</div>
            <div>
                <h2 class="font-bold text-sm text-[#FF85A1]">AI åŠ©æ‰‹æœ¬å‘¨é‡ç‚¹æé†’</h2>
                <p id="ai-week-summary" class="text-gray-600 text-xs mt-1 leading-relaxed">
                    åŠ è½½ä¸­...
                </p>
            </div>
        </div>

        <!-- åŠ¨æ€å†…å®¹æ¸²æŸ“ -->
        <div id="tab-content" class="space-y-4">
            <!-- ç”± JS å¡«å…… -->
        </div>

    </main>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 flex justify-around items-center h-16 safe-area-bottom shadow-[0_-5px_15px_rgba(0,0,0,0.05)] z-50">
        <button onclick="showTab('home')" id="btn-home" class="flex flex-col items-center space-y-1 text-pink-500">
            <i class="fas fa-home"></i><span class="text-[10px]">æ¦‚è§ˆ</span>
        </button>
        <button onclick="showTab('milestones')" id="btn-milestones" class="flex flex-col items-center space-y-1 text-gray-400">
            <i class="fas fa-list-ul"></i><span class="text-[10px]">æ¸…å•</span>
        </button>
        <button onclick="showTab('policy')" id="btn-policy" class="flex flex-col items-center space-y-1 text-gray-400">
            <i class="fas fa-gavel"></i><span class="text-[10px]">æ”¿ç­–</span>
        </button>
        <button onclick="showTab('ai')" id="btn-ai" class="flex flex-col items-center space-y-1 text-gray-400">
            <i class="fas fa-robot"></i><span class="text-[10px]">AIåŠ©æ‰‹</span>
        </button>
    </nav>

    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settings-modal" class="fixed inset-0 bg-black/50 hidden z-[60] flex items-center justify-center p-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4">å­•æœŸè®¾ç½®</h3>
            <p class="text-sm text-gray-500 mb-4">æœ€åä¸€æ¬¡æœˆç»(LMP)çš„ç¬¬ä¸€å¤©ï¼š</p>
            <input type="date" id="lmp-date" class="w-full border rounded-xl p-3 mb-4 focus:outline-none focus:ring-2 focus:ring-pink-300">
            <button onclick="saveSettings()" class="w-full gradient-bg text-white py-3 rounded-xl font-bold">å¼€å§‹è¿½è¸ª</button>
            <button onclick="closeSettings()" class="w-full mt-2 py-3 text-gray-400 text-sm">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        // --- æ•°æ®é…ç½® ---
        const milestones = [
            { week: 6, title: "ç¬¬ä¸€æ¬¡äº§æ£€", detail: "Bè¶…æ£€æŸ¥ç¡®è®¤å®«å†…æ€€å­•ï¼ŒæŸ¥çœ‹èƒå¿ƒèƒèŠ½ã€‚" },
            { week: 12, title: "æ­£å¼å»ºæ¡£ & NT", detail: "æˆéƒ½å»ºè®®åœ¨ç¤¾åŒºå«ç”Ÿä¸­å¿ƒæˆ–å®šç‚¹åŒ»é™¢é¢†ã€Šæ¯å­å¥åº·æ‰‹å†Œã€‹ã€‚" },
            { week: 16, title: "å”ç­›/æ— åˆ›", detail: "æ’æŸ¥æŸ“è‰²ä½“å¼‚å¸¸ã€‚" },
            { week: 24, title: "å¤§æ’ç•¸", detail: "ç³»ç»Ÿæ€§æ’æŸ¥èƒå„¿ç»“æ„ç•¸å½¢ã€‚" },
            { week: 32, title: "æ™šæœŸè¯„ä¼°", detail: "å…³æ³¨èƒä½åŠèƒç›˜åŠŸèƒ½ã€‚" }
        ];

        const chengduPolicies = [
            { 
                time: "ç¡®è®¤æ€€å­•å", 
                title: "ç”Ÿè‚²ç™»è®°", 
                detail: "é€šè¿‡â€˜å¤©åºœå¸‚æ°‘äº‘â€™Appæˆ–â€˜å››å·æ”¿åŠ¡æœåŠ¡ç½‘â€™è¿›è¡Œç½‘ä¸Šç™»è®°ã€‚è¿™æ˜¯åæœŸæŠ¥é”€ã€åŠå‡ºç”Ÿè¯çš„åŸºç¡€ã€‚" 
            },
            { 
                time: "å­•12å‘¨å‰", 
                title: "é¢†å–æ¯å­æ‰‹å†Œ", 
                detail: "å‡­èº«ä»½è¯ã€æ£€æŸ¥å•å»ç¤¾åŒºå«ç”ŸæœåŠ¡ä¸­å¿ƒé¢†å–ã€‚æˆéƒ½èŒå·¥åŒ»ä¿å¯äº«å—äº§å‰æ£€æŸ¥å®šé¢è¡¥åŠ©ã€‚" 
            },
            { 
                time: "åˆ†å¨©å‰", 
                title: "èŒå·¥åŒ»ä¿æŠ¥é”€å¤‡æ¡ˆ", 
                detail: "æˆéƒ½å‚ä¿èŒå·¥åœ¨å®šç‚¹åŒ»ç–—æœºæ„æŒç¤¾ä¿å¡åˆ·å¡ç»“ç®—ï¼Œå¯ç›´æ¥æŠ¥é”€éƒ¨åˆ†äº§æ£€åŠä½é™¢è´¹ã€‚" 
            },
            { 
                time: "åˆ†å¨©å180å¤©å†…", 
                title: "ç”Ÿè‚²æ´¥è´´é¢†å–", 
                detail: "ç”±å•ä½å‘åŒ»ä¿å±€ç”³è¯·ã€‚æˆéƒ½æ”¿ç­–ï¼šè¿ç»­ç¼´çº³åŒ»ä¿æ»¡6ä¸ªæœˆæˆ–12ä¸ªæœˆï¼ˆè§†å…·ä½“é™©ç§ï¼‰å³å¯äº«å—ã€‚" 
            }
        ];

        const aiTips = {
            1: "ç¬¬ä¸€æœˆï¼šå—ç²¾åµåˆšç€åºŠï¼Œæˆéƒ½æ—©æ™šæ¸©å·®å¤§æ³¨æ„é˜²å¯’ã€‚å¼€å§‹åƒå¶é…¸ï¼Œé¿å…æ¥è§¦å°„çº¿å’Œè¯ç‰©ã€‚",
            2: "ç¬¬äºŒæœˆï¼šæ—©å­•ååº”å¯èƒ½å¼€å§‹ã€‚è®°å¾—å»ç¤¾åŒºåŒ»é™¢å’¨è¯¢å»ºæ¡£æµç¨‹ï¼Œå‡†å¤‡å¥½ç»“å©šè¯å’Œèº«ä»½è¯ã€‚",
            3: "ç¬¬ä¸‰æœˆï¼šå®å®äººå½¢åˆç°ã€‚æœ¬å‘¨é‡ç‚¹æ˜¯é¢„çº¦NTæ£€æŸ¥ï¼Œæˆéƒ½å¸‚å¦‡å¹¼ç­‰çƒ­é—¨åŒ»é™¢éœ€è¦æå‰æŠ¢å·ã€‚",
            4: "ç¬¬å››æœˆï¼šè¿›å…¥ç¨³å®šæœŸã€‚æˆéƒ½èŒå·¥åŒ»ä¿çš„äº§æ£€æŠ¥é”€é€šå¸¸ä»æ­¤æ—¶å¼€å§‹è®¡å…¥ã€‚"
        };

        // --- åº”ç”¨é€»è¾‘ ---
        let appData = JSON.parse(localStorage.getItem('prego_data')) || { lmp: null };

        function init() {
            if (!appData.lmp) {
                openSettings();
            } else {
                updateDashboard();
                showTab('home');
            }
        }

        function updateDashboard() {
            const lmp = new Date(appData.lmp);
            const now = new Date();
            const diffDays = Math.ceil(Math.abs(now - lmp) / (1000 * 60 * 60 * 24));
            const edd = new Date(lmp.getTime() + 280 * 24 * 60 * 60 * 1000);
            const daysLeft = Math.ceil((edd - now) / (1000 * 60 * 60 * 24));
            
            const week = Math.floor(diffDays / 7);
            const day = diffDays % 7;

            document.getElementById('current-week-display').innerText = `å­• ${week} å‘¨ ${day} å¤©`;
            document.getElementById('days-left-display').innerText = daysLeft > 0 ? daysLeft : "0";
            document.getElementById('progress-bar').style.width = Math.min((diffDays / 280) * 100, 100) + '%';

            const month = Math.ceil(week / 4) || 1;
            document.getElementById('ai-week-summary').innerText = aiTips[month] || "è¿›å…¥å¹³ç¨³æœŸï¼Œæ³¨æ„æŒ‰æ—¶äº§æ£€ã€‚";
        }

        function showTab(tab) {
            const content = document.getElementById('tab-content');
            const btns = ['home', 'milestones', 'policy', 'ai'];
            btns.forEach(b => {
                document.getElementById('btn-' + b).classList.replace('text-pink-500', 'text-gray-400');
            });
            document.getElementById('btn-' + tab).classList.replace('text-gray-400', 'text-pink-500');

            if (tab === 'home') {
                content.innerHTML = `
                    <div class="card p-5 mb-4">
                        <h3 class="font-bold mb-3 flex items-center"><i class="fas fa-heart text-pink-500 mr-2"></i> å®å¦ˆä»Šæ—¥çŠ¶æ€æé†’</h3>
                        <ul class="space-y-3 text-sm text-gray-600">
                            <li>âœ¨ è®°å¾—æ¯å¤©æ—©é¤åæœç”¨å¶é…¸ã€‚</li>
                            <li>ğŸ’§ æˆéƒ½ç©ºæ°”å¹²ç‡¥ï¼Œæ³¨æ„å®¤å†…åŠ æ¹¿å’Œæ°´åˆ†è¡¥å……ã€‚</li>
                            <li>ğŸ’¤ ä¿è¯8å°æ—¶å……è¶³ç¡çœ ï¼Œèº«ä½“æ­£åœ¨ä¸ºå®å®æ„å»ºæ–°å®¶ã€‚</li>
                        </ul>
                    </div>
                    <div class="card p-5 bg-blue-50">
                        <h3 class="font-bold mb-2 text-blue-700">æˆéƒ½èŒå·¥æ”¿ç­–æœ€è¿‘åŠ¨æ€</h3>
                        <p class="text-xs text-blue-600 leading-relaxed">2024å¹´èµ·ï¼Œæˆéƒ½ç”Ÿè‚²ä¿é™©ä¸åŒ»ä¿åˆå¹¶ï¼Œåªè¦æ˜¯åœ¨èŒç¼´çº³èŒå·¥åŒ»ä¿ï¼Œäº§å‡æœŸé—´å¯é¢†ç”Ÿè‚²æ´¥è´´ï¼ˆå·¥èµ„è¡¥å¿ï¼‰ï¼Œä¸”äº§æ£€è´¹æœ‰å®šé¢è¡¥åŠ©ã€‚</p>
                    </div>
                `;
            } else if (tab === 'milestones') {
                content.innerHTML = '<h3 class="font-bold text-lg mb-4 pl-2">äº§æ£€æ—¶é—´è½´</h3>' + 
                    milestones.map(m => `
                        <div class="card p-4 flex space-x-4 mb-3">
                            <div class="bg-pink-100 text-pink-600 rounded-xl px-3 py-2 text-center min-w-[60px]">
                                <span class="text-[10px] block">ç¬¬</span>
                                <span class="text-lg font-bold block">${m.week}</span>
                                <span class="text-[10px] block">å‘¨</span>
                            </div>
                            <div>
                                <h4 class="font-bold">${m.title}</h4>
                                <p class="text-xs text-gray-500 mt-1">${m.detail}</p>
                            </div>
                        </div>
                    `).join('');
            } else if (tab === 'policy') {
                content.innerHTML = '<h3 class="font-bold text-lg mb-4 pl-2">æˆéƒ½æ”¿ç­–åŠç†èŠ‚ç‚¹</h3>' + 
                    chengduPolicies.map(p => `
                        <div class="card p-5 mb-3 border-t-4 border-blue-400">
                            <div class="flex justify-between items-center mb-2">
                                <span class="bg-blue-100 text-blue-700 text-[10px] px-2 py-1 rounded">${p.time}</span>
                                <h4 class="font-bold text-gray-800">${p.title}</h4>
                            </div>
                            <p class="text-xs text-gray-600 leading-relaxed">${p.detail}</p>
                        </div>
                    `).join('');
            } else if (tab === 'ai') {
                content.innerHTML = `
                    <div class="flex flex-col h-[50vh]">
                        <div class="flex-1 overflow-y-auto space-y-4 p-2" id="chat-box">
                            <div class="chat-bubble-ai p-3 text-sm max-w-[80%] shadow-sm">
                                ä½ å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å­•æœŸç®¡å®¶ã€‚å…³äºæˆéƒ½å»ºæ¡£ã€å­•æ—©æœŸé¥®é£Ÿæˆ–æ”¿ç­–è¡¥è´´ï¼Œæ‚¨å¯ä»¥é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚
                            </div>
                        </div>
                        <div class="mt-4 flex space-x-2">
                            <input id="chat-input" type="text" placeholder="é—®é—®AIå°åŠ©æ‰‹..." class="flex-1 border rounded-full px-4 text-sm focus:outline-none focus:ring-2 focus:ring-pink-300">
                            <button onclick="sendMessage()" class="gradient-bg text-white w-10 h-10 rounded-full flex items-center justify-center">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const box = document.getElementById('chat-box');
            if (!input.value) return;

            const userMsg = input.value;
            box.innerHTML += `<div class="flex justify-end"><div class="chat-bubble-user p-3 text-sm max-w-[80%] shadow-sm">${userMsg}</div></div>`;
            
            // ç®€å•æ¨¡æ‹ŸAIé€»è¾‘
            setTimeout(() => {
                let reply = "è¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ã€‚å»ºè®®æ‚¨å¯ä»¥å…ˆåœ¨â€˜å¤©åºœå¸‚æ°‘äº‘â€™AppæŸ¥çœ‹æˆéƒ½å¸‚æœ€æ–°çš„ç”Ÿè‚²æœåŠ¡æŒ‡å—ï¼Œæˆ–è€…å’¨è¯¢æ‚¨é€‰å®šçš„äº§æ£€åŒ»é™¢ã€‚æˆ‘ä¼šæŒç»­ä¸ºæ‚¨å­¦ä¹ æ›´å¤šæˆéƒ½æœ¬åœ°æ”¿ç­–ï¼";
                if (userMsg.includes("æŠ¥é”€")) reply = "æˆéƒ½å¸‚èŒå·¥ç”Ÿè‚²ä¿é™©æŠ¥é”€é€šå¸¸åŒ…å«ï¼š1.äº§å‰æ£€æŸ¥è´¹ï¼ˆå®šé¢è¡¥åŠ©ï¼‰ï¼›2.ä½é™¢åˆ†å¨©è´¹ï¼ˆåŒ»ä¿ç›®å½•å†…æŠ¥é”€ï¼‰ï¼›3.ç”Ÿè‚²æ´¥è´´ï¼ˆäº§å‡æœŸé—´å·¥èµ„ï¼‰ã€‚";
                if (userMsg.includes("å¶é…¸")) reply = "æˆéƒ½çš„ç¤¾åŒºå«ç”ŸæœåŠ¡ä¸­å¿ƒï¼ˆå¦‚è·³è¹¬æ²³ã€åŒæ¡¥å­ç¤¾åŒºç­‰ï¼‰é€šå¸¸å¯ä»¥å‡­èº«ä»½è¯å…è´¹é¢†å–å¶é…¸ç‰‡ï¼Œæ‚¨ä¹Ÿå¯ä»¥å»è¯åº—è´­ä¹°0.4mgè§„æ ¼çš„ã€‚";
                
                box.innerHTML += `<div class="chat-bubble-ai p-3 text-sm max-w-[80%] shadow-sm">${reply}</div>`;
                box.scrollTop = box.scrollHeight;
            }, 500);
            
            input.value = "";
            box.scrollTop = box.scrollHeight;
        }

        function openSettings() { document.getElementById('settings-modal').classList.remove('hidden'); }
        function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); }
        function saveSettings() {
            const date = document.getElementById('lmp-date').value;
            if (date) {
                appData.lmp = date;
                localStorage.setItem('prego_data', JSON.stringify(appData));
                updateDashboard();
                closeSettings();
                showTab('home');
            }
        }

        window.onload = init;
    </script>
</body>
</html>
